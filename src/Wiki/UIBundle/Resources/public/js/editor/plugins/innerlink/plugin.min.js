tinymce.PluginManager.add('innerlink', function(editor, url) {
    // Add a button that opens a window
    editor.addButton('innerlink', {
		tooltip:"插入内部链接",
        icon: 'link',
        onclick: function() {
            // Open window
			var data = {};
			selectedElm = editor.selection.getNode();
			anchorElm = editor.dom.getParent(selectedElm, 'a[href]');
			if (anchorElm) {
				data.text = anchorElm.innerText;
				data.link = anchorElm.title;
			} else{
				if(editor.selection.getContent({format: 'text'})!='') {
					data.text = editor.selection.getContent({format: 'text'});
					data.link = editor.selection.getContent({format: 'text'});
				} else {
					data.text = $(selectedElm).text();
					data.link = $(selectedElm).text();
					console.log('----');
				}
			}
			/*data.text = anchorElm?(anchorElm.innerText||selectedElm.textContent) : editor.selection.getContent({format: 'text'});
			data.link = anchorElm?(anchorElm.title||selectedElm.textContent) : editor.selection.getContent({format: 'text'});
			console.log($(selectedElm).text());*/
            editor.windowManager.open({
                title: '插入内部链接',
				data: data,
                body: [
                    {type: 'textbox', name: 'link', label: '链接'}
                ],
                onsubmit: function(e) {
					if (anchorElm) {
						editor.focus();
						anchorElm.innerHTML = data.text;

						editor.dom.setAttribs(anchorElm, {
							href: 'article/'+e.data.link,
							target: '_blank',
							title: e.data.link
						});

						editor.selection.select(anchorElm);
					} else {
						if (editor.selection.getContent({format: 'text'})=='') {
							$(selectedElm).html('');
						}
						editor.insertContent(editor.dom.createHTML("a", {
							href: 'article/'+e.data.link,
							target: '_blank',
							title: e.data.link
						}, data.text));
					}
                }
            });
        }
    });
/*
    // Adds a menu item to the tools menu
    editor.addMenuItem('example', {
        text: 'Example plugin',
        context: 'tools',
        onclick: function() {
            // Open window with a specific url
            editor.windowManager.open({
                title: 'TinyMCE site',
                url: 'http://www.tinymce.com',
                width: 800,
                height: 600,
                buttons: [{
                    text: 'Close',
                    onclick: 'close'
                }]
            });
        }
    });*/
});

